# v14.0.1 Happy Path Rehearsal

**Purpose:** Full end-to-end workflow verification
**Status:** Template (to be executed by operator)
**Date:** 2025-12-12

---

## Prerequisites

- [ ] System tagged v14.0.1+
- [ ] `python tools/burnin_smoke.py` passes
- [ ] Fresh workspace (or clean slate)

---

## The Happy Path

### Phase 1: Bootstrap (Context Gate Test)

```powershell
# Should show BOOTSTRAP mode initially
python -c "from mesh_server import get_context_readiness; import json; print(json.loads(get_context_readiness())['status'])"
# Expected: BOOTSTRAP

# Try strategic command (should block)
# In control_panel.ps1:
/draft-plan
# Expected: ðŸ”’ COMMAND LOCKED IN BOOTSTRAP MODE

# Fill minimal context docs
notepad docs/PRD.md
# Add:
# ## Goals
# - Test the happy path
#
# ## User Stories
# - As an operator, I want to verify all gates work

notepad docs/SPEC.md
# Add:
# ## Data Model
# - tasks table with risk/qa_status fields
#
# ## API
# - verify_task endpoint
#
# ## Security
# - All gates enforce properly

notepad docs/DECISION_LOG.md
# Add:
# ## Records
# | ID | Decision | Date |
# |----|----------|------|
# | 1  | Use v14.0.1 | 2025-12-12 |

# Verify readiness improved
python -c "from mesh_server import get_context_readiness; import json; r = json.loads(get_context_readiness()); print(f\"Status: {r['status']}, PRD: {r['files']['PRD']['score']}%\")"
# Expected: Status should move toward EXECUTION as scores improve
```

**Checkpoint 1:** âœ… Context Gate blocks strategic ops until docs ready

---

### Phase 2: Planning (Router Test)

```powershell
# Read-only queries (Router READONLY test)
python -c "from mesh_server import route_cli_input; import json; r = json.loads(route_cli_input('AUTO', 'show status')); print(f\"Command: {r['command']}, Complexity: {r['complexity']}\")"
# Expected: Command: /ops or /status, Complexity: READONLY

# Strategic planning (once EXECUTION mode)
/draft-plan
# Expected: Creates docs/PLANS/draft_YYYYMMDD_HHMM.md

# Edit plan to add HIGH risk task
notepad docs/PLANS/draft_*.md
# Add:
# ## [Backend]
# - [ ] Backend: Implement authentication system

/accept-plan draft_*.md
# Expected: Hydrates DB with tasks
```

**Checkpoint 2:** âœ… Router correctly classifies queries, planning works in EXECUTION mode

---

### Phase 3: Task Execution (Kickback Test)

```powershell
# Get first task
python -c "from mesh_server import upsert_task; import json; r = json.loads(upsert_task('Implement auth login [SEC]', 'SEC', '', '', 'Security-critical feature', 'HIGH')); print(f\"Task: {r['task_id']}\")"
# Note the task ID (e.g., T-123)

# Simulate unclear spec - use Kickback
# In control_panel.ps1 (if implemented) or via tool:
python -c "from mesh_server import get_db; conn = get_db(); conn.execute(\"UPDATE tasks SET status='blocked' WHERE id=1\"); conn.commit(); print('Task kicked back')"

# Verify status changed
python -c "from mesh_server import get_db; row = get_db().execute('SELECT id, status, risk FROM tasks WHERE id=1').fetchone(); print(f'Task {row[0]}: status={row[1]}, risk={row[2]}')"
# Expected: status=blocked
```

**Checkpoint 3:** âœ… Kickback mechanism allows status updates

---

### Phase 4: Review Submission (Optimization Gate Test)

```powershell
# Simulate task completion (move to reviewing)
python -c "from mesh_server import get_db; conn = get_db(); conn.execute(\"UPDATE tasks SET status='reviewing' WHERE id=1\"); conn.commit(); print('Task in review')"

# Try approval WITHOUT entropy check (should block)
python -c "from mesh_server import submit_review_decision; r = submit_review_decision(1, 'APPROVE', 'Looks good', 'HUMAN'); import json; print(json.loads(r))"
# Expected: status=BLOCKED, reason=MISSING_ENTROPY_CHECK

# Try approval WITH entropy check (should pass)
python -c "from mesh_server import submit_review_decision; r = submit_review_decision(1, 'APPROVE', 'Entropy Check: Passed âœ…', 'HUMAN'); import json; print(json.loads(r))"
# Expected: status=OK or similar success

# Verify task completed
python -c "from mesh_server import get_db; row = get_db().execute('SELECT status FROM tasks WHERE id=1').fetchone(); print(f'Status: {row[0]}')"
# Expected: status=completed
```

**Checkpoint 4:** âœ… Optimization Gate blocks approval without proof

---

### Phase 5: QA Verification (Risk Gate Test)

```powershell
# Create HIGH risk task
python -c "from mesh_server import upsert_task; import json; r = json.loads(upsert_task('Migrate auth schema [MIGRATION]', 'MIGRATION', '', '', 'Database migration', 'HIGH')); print(f\"Task: {r['task_id']} (risk should be HIGH)\")"

# Move to completed (simulate implementation done)
python -c "from mesh_server import get_db; conn = get_db(); conn.execute(\"UPDATE tasks SET status='completed', files_changed='[\\\"migration.py\\\"]' WHERE id=2\"); conn.commit(); print('Task ready for QA')"

# Try to ship WITHOUT /verify (should block in control_panel.ps1)
# Simulate the /ship query:
python -c "from mesh_server import get_db; rows = get_db().execute(\"SELECT id, desc, risk, qa_status FROM tasks WHERE risk='HIGH' AND qa_status!='PASS'\").fetchall(); print(f'HIGH risk tasks without PASS: {len(rows)}'); [print(f'  T-{r[0]}: {r[1][:50]} (qa_status={r[3]})') for r in rows]"
# Expected: Shows task(s) blocking ship

# Run /verify to get PASS
python -c "from mesh_server import verify_task; import json; r = json.loads(verify_task('2')); print(f\"Score: {r.get('score')}/100, Status: {r.get('status')}\")"
# Expected: Generates QA report, sets qa_status

# Verify qa_status updated
python -c "from mesh_server import get_db; row = get_db().execute('SELECT qa_status FROM tasks WHERE id=2').fetchone(); print(f'QA Status: {row[0]}')"
# Expected: qa_status=PASS (if score â‰¥80) or WARN/FAIL

# Try to ship again (should succeed if PASS)
python -c "from mesh_server import get_db; rows = get_db().execute(\"SELECT id FROM tasks WHERE risk='HIGH' AND qa_status!='PASS'\").fetchall(); print('Ship blocked!' if rows else 'Ship allowed âœ…')"
# Expected: "Ship allowed âœ…" (if verify passed)
```

**Checkpoint 5:** âœ… Risk Gate blocks HIGH risk tasks without QA PASS

---

### Phase 6: Fail-Open Verification

```powershell
# This is verified via code inspection and smoke tests
# See: tools/burnin_smoke.py - test_gate_6_failopen()

# Manually verify readiness check graceful failure:
# Temporarily rename tools/readiness.py â†’ tools/readiness.py.bak
# Run strategic command - should fail open or show warning
# Restore tools/readiness.py
```

**Checkpoint 6:** âœ… Fail-open prevents deadlock (verified via smoke test)

---

## Final Verification

```powershell
# Run full smoke test suite
python tools/burnin_smoke.py
# Expected: âœ… ALL TESTS PASSED (7/7)

# Run regression tests
python tests/test_regression_imports.py
# Expected: OK (6 tests pass)
```

---

## Outcome Documentation

**After completing this rehearsal:**

1. Take screenshots or save terminal output of each checkpoint
2. Document any deviations from expected behavior
3. If all checkpoints pass, add:

```
## Execution Log

Date: YYYY-MM-DD
Operator: [name]
Result: âœ… PASS

All 6 checkpoints verified:
- Context Gate: âœ…
- Router READONLY: âœ…
- Kickback: âœ…
- Optimization Gate: âœ…
- Risk Gate: âœ…
- Fail-Open: âœ…

System Status: PRODUCTION READY
```

---

## Notes for Operators

- **Do not skip checkpoints** - Each tests a different gate
- **Expected failures are GOOD** - Gates should block unsafe operations
- **Document any surprises** - Unexpected passes or failures both matter
- **Keep artifacts** - QA reports in docs/QA/, decision logs, etc.

---

**This is a TEMPLATE.** Actual execution should populate the "Execution Log" section with real results.
